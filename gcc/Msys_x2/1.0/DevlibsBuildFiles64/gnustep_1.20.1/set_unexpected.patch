diff -Naur libobjc/ChangeLog libobjc.new/ChangeLog
--- libobjc/ChangeLog	2008-11-28 15:45:30.000000000 +0000
+++ libobjc.new/ChangeLog	2008-11-28 15:40:02.000000000 +0000
@@ -1,3 +1,9 @@
+2008-11-28  Richard Frith-Macdonald  <rfm@gnu.org>
+
+	* objc/objc-api.h: declare objc_set_unexpected function.
+	* exception.c: implement objc_set_unexpected function.
+	* libobjc.def: export objc_set_unexpected
+
 2008-11-21  Kai Tietz  <kai.tietz@onevision.com>
 
 	*  Object.m (errno): Replaced by errno.h include.
diff -Naur libobjc/exception.c libobjc.new/exception.c
--- libobjc/exception.c	2008-11-28 15:45:30.000000000 +0000
+++ libobjc.new/exception.c	2008-11-28 15:10:24.000000000 +0000
@@ -469,6 +469,14 @@
   free (exc);
 }
 
+static void (*__unexpected)(id) = 0;
+
+void
+objc_set_unexpected (void (*handler)(id))
+{
+  __unexpected = handler;
+}
+
 void
 objc_exception_throw (id value)
 {
@@ -486,5 +494,9 @@
 #endif
 
   /* Some sort of unwinding error.  */
+  if (__unexpected != 0)
+    {
+      (*__unexpected) (value);
+    }
   abort ();
 }
diff -Naur libobjc/libobjc.def libobjc.new/libobjc.def
--- libobjc/libobjc.def	2008-11-28 15:45:30.000000000 +0000
+++ libobjc.new/libobjc.def	2008-11-28 14:38:08.000000000 +0000
@@ -38,6 +38,7 @@
 objc_mutex_lock
 objc_mutex_trylock
 objc_mutex_unlock
+objc_set_unexpected
 objc_thread_detach
 objc_thread_exit
 objc_thread_get_data
diff -Naur libobjc/objc/objc-api.h libobjc.new/objc/objc-api.h
--- libobjc/objc/objc-api.h	2008-11-28 15:45:29.000000000 +0000
+++ libobjc.new/objc/objc-api.h	2008-11-28 14:36:38.000000000 +0000
@@ -430,6 +430,14 @@
 objc_EXPORT IMP (*__objc_msg_forward)(SEL);
 objc_EXPORT IMP (*__objc_msg_forward2)(id, SEL);
 
+/*
+**  Function to set the handler to be called when an exception is thrown
+**  but not caught.
+*/
+void
+objc_set_unexpected (void (*handler)(id));
+
+
 Method_t class_get_class_method(MetaClass _class, SEL aSel);
 
 Method_t class_get_instance_method(Class _class, SEL aSel);
diff -Naur libobjc/objc/.svn/entries libobjc.new/objc/.svn/entries
--- libobjc/objc/.svn/entries	2008-11-28 15:45:29.000000000 +0000
+++ libobjc.new/objc/.svn/entries	2008-11-28 08:25:22.000000000 +0000
@@ -1,7 +1,7 @@
 8
 
 dir
-142258
+142255
 svn://gcc.gnu.org/svn/gcc/trunk/libobjc/objc
 svn://gcc.gnu.org/svn/gcc
 
@@ -32,7 +32,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 09c8d66e88248bf608009291527bb2a5
 2008-11-21T12:07:43.271740Z
 142087
@@ -44,7 +44,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 ec113c9208369cd3f6d3f99b51a69470
 2005-08-17T03:21:42.000000Z
 103197
@@ -56,7 +56,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 91ab26bbac7d284c7ce478b776e4c84e
 2005-08-17T03:21:42.000000Z
 103197
@@ -68,7 +68,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 61e765a5af1d80618605dbb76d4a28bf
 2005-08-17T03:21:42.000000Z
 103197
@@ -80,7 +80,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 52024d61a674d6e143ad0f09ffa7933f
 2005-08-17T03:21:42.000000Z
 103197
@@ -92,7 +92,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 6cd4b357ba69b8a8a95df729ebce5cb3
 2005-11-20T12:49:41.883364Z
 107251
@@ -104,7 +104,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 fb6f645c968daffebacfa17b376103a4
 2005-08-17T03:21:42.000000Z
 103197
@@ -116,7 +116,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 a0fe64ea41e98a218e9fa7abf39f1c60
 2007-04-09T18:04:50.999334Z
 123678
@@ -128,7 +128,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 0c2a34678090093c801b898172eb484c
 2005-08-17T03:21:42.000000Z
 103197
@@ -140,7 +140,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 c7d0efdd99197bebee159d315f2671ca
 2005-08-17T03:21:42.000000Z
 103197
@@ -152,7 +152,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 b7919abbb9ff020bf824368ee152719b
 2008-06-10T12:37:51.447092Z
 136617
@@ -164,7 +164,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 6635e7ff8386b7c2c9a97594ad4b091d
 2005-08-17T03:21:42.000000Z
 103197
@@ -176,7 +176,7 @@
 
 
 
-2008-11-28T15:45:29.000000Z
+2008-11-28T08:25:22.000000Z
 53cbcb49d36ba5dfb1ac786e89f85863
 2007-02-18T11:55:53.900037Z
 122090
diff -Naur libobjc/.svn/entries libobjc.new/.svn/entries
--- libobjc/.svn/entries	2008-11-28 15:45:30.000000000 +0000
+++ libobjc.new/.svn/entries	2008-11-28 08:25:22.000000000 +0000
@@ -1,7 +1,7 @@
 8
 
 dir
-142258
+142255
 svn://gcc.gnu.org/svn/gcc/trunk/libobjc
 svn://gcc.gnu.org/svn/gcc
 
@@ -32,7 +32,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 f9dc89fc3612d42c77ab2b807e12c07e
 2008-11-21T12:07:43.271740Z
 142087
@@ -44,7 +44,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 23dca70c55a4702a93ec8bd8eab4cdf9
 2008-09-26T16:33:53.865381Z
 140703
@@ -57,7 +57,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 cf29b30f5a9568f5d701f03200fb476a
 2008-07-18T16:30:04.806646Z
 137956
@@ -69,7 +69,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 f24efa2fd5250907dea44d94f84a70ff
 2005-08-17T03:21:42.000000Z
 103197
@@ -81,7 +81,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 2ee0ad2e597b5139e7540846e1bcf5a7
 2005-08-17T03:21:42.000000Z
 103197
@@ -93,7 +93,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 a2d0a2cb6330c5ab046d41aa5cddaec9
 2005-08-17T03:21:42.000000Z
 103197
@@ -105,7 +105,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 c908e776662db2f2b5ebfafbfbe7b672
 2005-08-17T03:21:42.000000Z
 103197
@@ -117,7 +117,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 9fe6d51233d7e4f8622ab7189bb970ce
 2005-08-17T03:21:42.000000Z
 103197
@@ -129,7 +129,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 95d9c99ff185dc39a81c6d4521741823
 2005-08-17T03:21:42.000000Z
 103197
@@ -141,7 +141,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 8c139a4f54ba9fdaa09715caeeb6aa23
 2006-02-21T19:13:21.667879Z
 111339
@@ -153,7 +153,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 440a59ef5eeb54b012a2da2368e3ecf6
 2005-08-17T03:21:42.000000Z
 103197
@@ -165,7 +165,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 dc40c43e3b37ec7b0fc4a64a75a54c87
 2005-08-17T03:21:42.000000Z
 103197
@@ -177,7 +177,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 e2ff9d01d9f1cfa0b875ce081de1c691
 2005-08-17T03:21:42.000000Z
 103197
@@ -189,7 +189,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 32591f2f2426807ebd929112339fc415
 2005-08-17T03:21:42.000000Z
 103197
@@ -201,7 +201,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 2dd872e1aa34f9eda1155a06808a06f2
 2005-08-17T03:21:42.000000Z
 103197
@@ -213,7 +213,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 04172dc01230eaa2ce321d62de8c5739
 1999-09-04T15:09:22.000000Z
 29102
@@ -225,7 +225,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 b89bed97ac83b311682d33cdbb3b264c
 2005-08-17T03:21:42.000000Z
 103197
@@ -237,7 +237,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 460670c4bd0402589617dcf5c9f261f1
 2007-10-14T18:17:14.403980Z
 129299
@@ -249,7 +249,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 443e0f51e4234f65f9c053e1c069809d
 2005-08-17T03:21:42.000000Z
 103197
@@ -261,7 +261,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 0920835505f8fb0059bf64da0ac3b5d3
 2005-08-17T03:21:42.000000Z
 103197
@@ -273,7 +273,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 f1b18982f4ea99203fe8176c6964a6b2
 2008-05-25T03:58:15.827585Z
 135858
@@ -285,7 +285,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 e783ac62e749500d23f0e9cfdb4641e5
 2005-08-17T03:21:42.000000Z
 103197
@@ -297,7 +297,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 c60e6bf9cffec7e20c3f3ab7bb5ce00d
 2008-11-21T12:07:43.271740Z
 142087
@@ -309,7 +309,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 2d877205f43c10c22518df4e7b1a1ad0
 2008-11-21T12:07:43.271740Z
 142087
@@ -321,7 +321,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 7f2482ac15012de9268b36050e48971f
 2005-08-17T03:21:42.000000Z
 103197
@@ -333,7 +333,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 cd0cfe67afa625f8f0e818c7499a7b25
 2005-08-17T03:21:42.000000Z
 103197
@@ -345,7 +345,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 86318157298374df01b719e85194bc71
 2008-06-14T10:58:22.958697Z
 136782
@@ -357,7 +357,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 b72b505ce44f731e074f50699c5692e8
 2005-08-17T03:21:42.000000Z
 103197
@@ -369,7 +369,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 2ba2a81a6b56c077d16e14c5739e2ed9
 2005-08-17T03:21:42.000000Z
 103197
@@ -381,7 +381,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 27c9f493b5d949850335da1efa9e1335
 2005-08-17T03:21:42.000000Z
 103197
@@ -393,7 +393,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 25a63d98d74b70ef05b601805902d36d
 1999-09-04T15:09:22.000000Z
 29102
@@ -405,7 +405,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 4dccb1b5f68fcdd0132e7694ca1a7282
 2008-11-21T12:07:43.271740Z
 142087
@@ -417,7 +417,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 5f43a1e6c71bc1280356588a4137977d
 2001-06-08T22:42:59.000000Z
 43058
@@ -429,7 +429,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 d5edaeee0d84e4305368367019952ba7
 2005-12-15T16:46:17.037352Z
 108584
@@ -441,7 +441,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 dc40c43e3b37ec7b0fc4a64a75a54c87
 2005-08-17T03:21:42.000000Z
 103197
@@ -453,7 +453,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 98d6cf7cf290fc553d9c4b75c5157803
 2008-09-26T16:33:53.865381Z
 140703
@@ -465,7 +465,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 7f788f75e3be868f2c06d813003477c6
 2008-11-21T12:07:43.271740Z
 142087
@@ -477,7 +477,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 38820fd3c768e5563d47c3dc4fb59a1e
 2008-06-10T12:37:51.447092Z
 136617
@@ -489,7 +489,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 6f0c2aa2fb9d8b286d79cf85f05edea0
 2005-08-17T03:21:42.000000Z
 103197
@@ -501,7 +501,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 699379f016a7be9f58ad8d4833725d66
 2004-10-20T01:26:37.000000Z
 89312
@@ -513,7 +513,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 01b7a3fdf418543a74f29111f7c31e2f
 2005-08-17T03:21:42.000000Z
 103197
@@ -525,7 +525,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 e2ff9d01d9f1cfa0b875ce081de1c691
 2005-08-17T03:21:42.000000Z
 103197
@@ -537,7 +537,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 efd3effc2f914fd624545f531507be79
 2006-01-24T23:37:24.886100Z
 110187
@@ -549,7 +549,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 465941444484732053196c2ee0a53f8d
 2005-08-17T03:21:42.000000Z
 103197
@@ -564,7 +564,7 @@
 
 
 
-2008-11-28T15:45:30.000000Z
+2008-11-28T08:25:22.000000Z
 23739476091664973963f495699e307e
 2008-04-18T10:28:53.841355Z
 134434
